I"£<p>å‡è®¾ä¸€ä¸‹ä¸‹é¢çš„åœºæ™¯ï¼šæŸAPPé¦–é¡µåˆ†ä¸ºå¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä½¿ç”¨ä¸åŒçš„æ•°æ®æ¥å£ï¼Œä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œåœ¨åŠ è½½é¦–é¡µæ—¶å¯ä»¥å…ˆå°†æ‰€æœ‰æ¨¡å—æ•°æ®æ‹¿åˆ°åå†åŠ è½½UIï¼Œä½†ä¸ç”¨è€ƒè™‘å“ªä¸ªæ¨¡å—å…ˆå¾—åˆ°æ•°æ®ã€‚è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨GCDçš„ <code class="highlighter-rouge">dispatch_group è°ƒåº¦ç¾¤ç»„</code> å¾ˆå®¹æ˜“å¤„ç†ã€‚</p>

<p><strong>dispatch_group åŒ…å«çš„å‡½æ•°</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/* ç”Ÿæˆ group å®ä¾‹ */
dispatch_group_create()

/* group  è°ƒåº¦ç¾¤ç»„
 * queue  ä»»åŠ¡æ‰§è¡Œé˜Ÿåˆ—
 * block  ä»»åŠ¡å†…å®¹ */
dispatch_group_async(&lt;#dispatch_group_t _Nonnull group#&gt;, &lt;#dispatch_queue_t _Nonnull queue#&gt;, &lt;#^(void)block#&gt;)

/* group  è°ƒåº¦ç¾¤ç»„ï¼Œä¸è¢«æäº¤çš„å‡½æ•°ç›¸å…³è”ã€‚è¯¥ç¾¤ç»„è¢«ç³»ç»Ÿä¿ç•™ï¼Œç›´åˆ°åº”ç”¨ç¨‹åºä¸­å®šä¹‰å¥½çš„å‡½æ•°æ‰§è¡Œå®Œæ¯•ã€‚ä¸å¯ä»¥ä¸ºNULLã€‚
 * queue  è°ƒåº¦é˜Ÿåˆ—ï¼Œç”¨äºæäº¤ç³»ç»Ÿå®šä¹‰å¥½çš„å‡½æ•°ï¼Œå¼‚æ­¥è°ƒç”¨ã€‚è¯¥é˜Ÿåˆ—è¢«ç³»ç»Ÿä¿ç•™ï¼Œç›´åˆ°åº”ç”¨ç¨‹åºå®šä¹‰å¥½çš„å‡½æ•°æ‰§è¡Œå®Œæ¯•ã€‚ä¸å¯ä»¥ä¸ºNULLã€‚
 * context  æ˜¯ç”±ç¨‹åºå®šä¹‰çš„ï¼Œç”¨äºä¼ é€’ç»™workçš„å‚æ•°ã€‚
 * work  åº”ç”¨ç¨‹åºå®šä¹‰çš„å‡½æ•°ï¼Œåœ¨ç›®æ ‡é˜Ÿåˆ—ä¸­è°ƒç”¨ã€‚workçš„ç¬¬ä¸€ä¸ªå‚æ•°å€¼æ˜¯contextã€‚*/
dispatch_group_async_f(&lt;#dispatch_group_t _Nonnull group#&gt;, &lt;#dispatch_queue_t _Nonnull queue#&gt;, &lt;#void * _Nullable context#&gt;, &lt;#dispatch_function_t _Nonnull work#&gt;) 

/* è°ƒç”¨ä¸€æ¬¡è¯¥å‡½æ•°ä¼šä½¿å½“å‰ç¾¤ç»„ä¸­æœªæ‰§è¡Œä»»åŠ¡çš„è®¡æ•°åŠ ä¸€ï¼Œä¸ `dispatch_group_leave` ä¸€èµ·ä½¿ç”¨ï¼Œä¸¤è€…è°ƒç”¨æ¬¡æ•°åº”ä¿æŒä¸€è‡´ã€‚
 * group  è°ƒåº¦ç¾¤ç»„ */
dispatch_group_enter(&lt;#dispatch_group_t _Nonnull group#&gt;)

/* è°ƒç”¨ä¸€æ¬¡è¯¥å‡½æ•°ä¼šä½¿å½“å‰ç¾¤ç»„ä¸­æœªæ‰§è¡Œä»»åŠ¡çš„è®¡æ•°å‡ä¸€ï¼Œä¸`dispatch_group_enter` ä¸€èµ·ä½¿ç”¨ï¼Œä¸¤è€…è°ƒç”¨æ¬¡æ•°åº”ä¿æŒä¸€è‡´ã€‚
 * group  è°ƒåº¦ç¾¤ç»„ */
dispatch_group_leave(&lt;#dispatch_group_t _Nonnull group#&gt;)

/* ç­‰å¾…è°ƒåº¦ç¾¤ç»„å…³è”çš„blockå†…ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œç­‰å¾…æœŸé—´ä¼šå µå¡å½“å‰çº¿ç¨‹ï¼Œä»»åŠ¡å®Œæˆåæ¢å¤æ­£å¸¸ï¼Œæ‰§è¡Œåç»­ä»»åŠ¡ã€‚
 * group  è°ƒåº¦ç¾¤ç»„
 * timeout  ç­‰å¾…æ—¶é—´ */
dispatch_group_wait(&lt;#dispatch_group_t _Nonnull group#&gt;, &lt;#dispatch_time_t timeout#&gt;)

/* ä½œç”¨ä¸ `dispatch_group_wait` ç±»ä¼¼ï¼Œä½†ä¸ä¼šå µå¡å½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šgroupå†…ä»»åŠ¡å®Œæˆä¹‹ååç»­ä»»åŠ¡çš„æ‰§è¡Œé˜Ÿåˆ—ï¼Œåç»­ä»»åŠ¡åœ¨blockä¸­æ‰§è¡Œ
 * group â€”â€” è°ƒåº¦ç¾¤ç»„
 * queue â€”â€” åç»­ä»»åŠ¡æ‰§è¡Œé˜Ÿåˆ—
 * block â€”â€” åœ¨è¿™é‡Œæ·»åŠ åç»­ä»»åŠ¡ */
dispatch_group_notify(&lt;#dispatch_group_t _Nonnull group#&gt;, &lt;#dispatch_queue_t _Nonnull queue#&gt;, &lt;#^(void)block#&gt;)

</code></pre></div></div>

<p><strong>ä½¿ç”¨dispatch_group_wait</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
dispatch_group_t group = dispatch_group_create();

for (int index = 0; index &lt; 5; index ++) {

    dispatch_group_async(group, queue, ^{

        NSLog(@"s1 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);
        [NSThread sleepForTimeInterval:3.0f];
        NSLog(@"s2 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);
    });

}

dispatch_group_wait(group, DISPATCH_TIME_FOREVER);    
NSLog(@"æ‰§è¡Œåç»­ä»»åŠ¡");
</code></pre></div></div>

<p><img src="http://upload-images.jianshu.io/upload_images/2475558-5759920039647f73?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p><strong>ä½¿ç”¨dispatch_group_notify</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
dispatch_group_t group = dispatch_group_create();

for (int index = 0; index &lt; 5; index ++) {

    dispatch_group_async(group, queue, ^{

       NSLog(@"s1 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);
       [NSThread sleepForTimeInterval:3.0f];
       NSLog(@"s2 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);

    });

}

dispatch_group_notify(group, queue, ^{

    NSLog(@"æ‰§è¡Œåç»­ä»»åŠ¡");
});
</code></pre></div></div>

<p><img src="http://upload-images.jianshu.io/upload_images/2475558-3fbaaeaafd3f3809?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p><strong>dispatch_group_enter ä¸ dispatch_group_leave çš„ä½¿ç”¨</strong></p>

<p>å¦‚æœåœ¨è°ƒåº¦ç¾¤ç»„å…³è”çš„blockå†…ç›´æ¥å¼‚æ­¥æäº¤æ–°çš„ä»»åŠ¡ï¼Œgroup ä¸ä¼šç­‰å¾…åµŒå¥—çš„å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ååœ¨è¿›å…¥ <code class="highlighter-rouge">dispatch_group_notify</code> å’Œ <code class="highlighter-rouge">dispatch_group_wait</code> çŠ¶æ€ï¼Œå¦‚ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); 
dispatch_group_t group = dispatch_group_create();

for (int index = 0; index &lt; 5; index ++) {

    dispatch_group_async(group, queue, ^{

       NSLog(@"s1 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);
       [NSThread sleepForTimeInterval:3.0f];
       NSLog(@"s2 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);

       dispatch_async(queue, ^{
          [NSThread sleepForTimeInterval:2.0f];
          NSLog(@"s3 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);
       });

    });    
}

dispatch_group_notify(group, queue, ^{

   NSLog(@"åç»­ä»»åŠ¡");
});
</code></pre></div></div>

<p><img src="http://upload-images.jianshu.io/upload_images/2475558-360e3fdc0c22e524?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåç»­ä»»åŠ¡æ²¡æœ‰åœ¨s1ã€s2ã€s3éƒ½æ‰§è¡Œå®Œæˆåæ‰§è¡Œï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">dispatch_group_enter</code> å‘Šè¯‰è°ƒåº¦ç¾¤æœ‰ç»„æ–°çš„ä»»åŠ¡åŠ å…¥ï¼Œä½¿æœªå®Œæˆä»»åŠ¡æ•°å¢åŠ ï¼›ä½¿ç”¨<code class="highlighter-rouge">dispatch_group_leave</code> ä½¿æœªå®Œæˆä»»åŠ¡æ•°å‡å°‘</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
dispatch_group_t group = dispatch_group_create();

for (int index = 0; index &lt; 5; index ++) {

    dispatch_group_async(group, queue, ^{

        NSLog(@"s1 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);
        [NSThread sleepForTimeInterval:3.0f];
        NSLog(@"s2 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);

        //æœ‰æ–°ä»»åŠ¡åŠ å…¥
        dispatch_group_enter(group);

        dispatch_async(queue, ^{
            [NSThread sleepForTimeInterval:2.0f];
            NSLog(@"s3 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);

            //æœ‰ä»»åŠ¡å®Œæˆ
            dispatch_group_leave(group);
        });

    });

}

dispatch_group_notify(group, queue, ^{

    NSLog(@"åç»­ä»»åŠ¡");
});
</code></pre></div></div>

<p><img src="http://upload-images.jianshu.io/upload_images/2475558-17f64b34f95edcf9?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<blockquote>
  <p>æ­¤å¤–ï¼Œdispatch_group_enter ä¸ dispatch_group_leave ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä½†éœ€è¦ä¿æŒä¸¤è€…è°ƒç”¨æ¬¡æ•°ä¸€è‡´ï¼Œé…åˆå¼‚æ­¥æ‰§è¡Œï¼Œå…¶æ•ˆæœå’Œ <code class="highlighter-rouge">dispatch_group_async</code> ç±»ä¼¼</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
dispatch_group_t group = dispatch_group_create();

for (int index = 0; index &lt; 5; index ++) {

    dispatch_group_enter(group);

    dispatch_async(queue, ^{

        NSLog(@"s1 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);
        [NSThread sleepForTimeInterval:3.0f];
        NSLog(@"s2 çº¿ç¨‹ï¼š%@ -- index = %d",[NSThread currentThread],index);

        dispatch_group_leave(group);

    });
}

dispatch_group_notify(group, queue, ^{

    NSLog(@"åç»­ä»»åŠ¡");
});
</code></pre></div></div>
:ET